<?phpdefined('BASEPATH') OR exit('<h1 style="text-transform: uppercase; font-weight: 300; color: red; text-align:center; margin-top: 20%;">Acesso não permitido</h1>');class Lockscreen extends CI_Controller {        public function __construct() {        parent::__construct();        $this->load->library('session');        $this->load->model('lockscreen_model', '', TRUE);        $this->data['menuUsuarios'] = 'Usuario';        $this->load->model('all_model','',TRUE);	$this->data['getUser'] = $this->all_model->obterID('user', 'user_perfil', 'user_perfil.id_user = user.idUser', 'idUser', $this->session->userdata('idUser'));        $this->data['config'] = $this->all_model->obterID('config_sistema','','','idConfig', '1');    }    public function index() { // esse aqui nao e precisa voce coloca cliente/index, so apenas clientes        $this->load->view('dashboard/lockscreen', $this->data);    }    public function user() {        $email = $this->uri->segment(3);        $email = base64_decode($email);        $this->data['recuperarDados'] = $this->all_model->obterID('user','user_perfil','user_perfil.id_user = user.idUser','email_user', $email);        $this->load->view('dashboard/lockscreen', $this->data);    }    public function logar() {        $this->form_validation->set_rules('senha', 'Senha', 'required|xss_clean|trim');        $ajax = $this->input->get('ajax');        if ($this->form_validation->run() == false) {            if ($ajax == true) {                $json = array('result' => false);                echo json_encode($json);            } else {                $this->session->set_flashdata('error', 'Os dados de acesso estão incorretos.');                redirect($this->login);            }        } else {            $email = $this->input->post('email');            $senha = $this->input->post('senha');            $this->load->library('encrypt');            $senha = $this->encrypt->sha1($senha);            $this->db->where('email', $email);            $this->db->where('senha', $senha);            $this->db->where('situacao', 1);            $this->db->limit(1);            $usuario = $this->db->get('usuarios')->row();            if (count($usuario) > 0) {                $dados = array('nome' => $usuario->nome, 'id' => $usuario->idUsuarios, 'email' => $usuario->email, 'permissao' => $usuario->permissoes_id, 'logado' => TRUE);                $this->session->set_userdata($dados);                if ($ajax == true) {                    $json = array('result' => true);                    echo json_encode($json);                } else {                    redirect(base_url() . 'dashboard');                }            } else {                if ($ajax == true) {                    $json = array('result' => false);                    echo json_encode($json);                } else {                    $this->session->set_flashdata('error', 'Os dados de acesso estão incorretos.');                    redirect($this->login);                }            }        }    }    // Função para Lockscreen    public function sair() {        function base64url_encode($data) {            return rtrim(strtr(base64_encode($data), '+/', '-_'), '=');        }        $email = $this->session->userdata('email_user');        $email = base64url_encode($email);        $this->session->sess_destroy();        redirect('lockscreen/user/' . $email);    }}