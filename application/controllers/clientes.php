<?phpdefined('BASEPATH') OR exit('<h1 style="text-transform: uppercase; font-weight: 300; color: red; text-align:center; margin-top: 20%;">Acesso não permitido</h1>');class Clientes extends CI_Controller {    private  $tabela = 'clientes';             function __construct() {        parent::__construct();        $this->load->library('form_validation');        $this->load->model('all_model','',TRUE);        $this->load->library('pagination');        $this->load->helpers('removetudo_helper');        $this->load->helpers('modal_helper');        $this->load->helpers('data_helper');        $this->data['clientes'] = 'Cliente';        $this->data['title'] = 'Clientes';	$this->data['dadosUsuario'] = $this->all_model->obterID('user', 'user_perfil', 'user_perfil.id_user = user.idUser', 'idUser', $this->session->userdata('idUser'));        $this->data['config'] = $this->all_model->obterID('config_sistema','','','idConfig', '1');    }    public function index(){        if(!$this->permission->checkPermission($this->session->userdata('permissao'),'vCliente')){           $this->session->set_flashdata('error','Você não tem permissão para visualizar Permissão.');           redirect(base_url());        }            $this->data['vCliente'] = '';            $this->data['obterCliente'] = $this->all_model->obterDado('clientes');            $this->data['view'] = 'clientes/clientes';            $this->load->view('tema/home',  $this->data);    }        public function adicionar() {        if(!$this->permission->checkPermission($this->session->userdata('permissao'),'aCliente')){           $this->session->set_flashdata('error','Você não tem permissão para visualizar Cliente.');           redirect(base_url());        }        $this->data['aCliente'] = 'Clientes';	$this->data['view'] = 'clientes/adicionar';        $this->load->view('tema/home',  $this->data);    }        function adicionarCliente(){                    $query = $this->db->get_where('clientes',array('cnpj_cpf ' => $this->input->post('cnpj_cpf')));            $result = $query->result_array();                        if(count($result) > 0) {                  echo json_encode(array('result' => true, 'mensagen' => 'Ops, CNPJ ou CPF já Cadastro.'));            }else{                            $cnpj_cpf = limpaCPF_CNPJ($this->input->post('cnpj_cpf'));                          $dados = array(                'razao_social_cliente' => $this->input->post('razao_social_cliente'),                'id_responsavel' => $this->input->post('id_responsavel'),                'nome_fantasia_cliente' => $this->input->post('nome_fantasia_cliente'),                'pessoa_cliente' => $this->input->post('pessoa_cliente'),                'cnpj_cpf' => $cnpj_cpf,                'telefone_cliente' => $this->input->post('telefone_cliente'),                'ie_cliente' => $this->input->post('ie_cliente'),                'tipo_ie_cliente' => $this->input->post('tipo_ie_cliente'),                'im_cliente' => $this->input->post('im_cliente'),                'cnae_cliente' => $this->input->post('cnae_cliente'),                'cep_cliente' => $this->input->post('cep_cliente'),                'endereco_cliente' => $this->input->post('endereco_cliente'),                'numero_cliente' => $this->input->post('numero_cliente'),                'bairro_cliente' => $this->input->post('bairro_cliente'),                'uf_cliente' => $this->input->post('uf_cliente'),                'pais_cliente' => $this->input->post('pais_cliente'),                'codigo_pais' => $this->input->post('codigo_pais'),                'codigo_cidade_cliente' => $this->input->post('codigo_cidade_cliente'),                'data_cadastro' => date('Y-m-d H:i:s')            );                    if ($this->all_model->inserirDados('clientes', $dados) == TRUE) {                echo json_encode(array('result' => true, 'mensagen' => 'Cliente Inserido com Sucesso'));            } else {                echo json_encode(array('result' => false, 'mensagen' => 'Ops, houve um error!'));            }        }    }                public function editar($obterID) {        if(!$this->permission->checkPermission($this->session->userdata('permissao'),'eCliente')){           $this->session->set_flashdata('error','Você não tem permissão para visualizar Cliente.');           redirect(base_url());        }                       $getRestrito = $this->all_model->obterID('clientes', '', '', 'id_clientes', $obterID);	if (!$getRestrito) {	    $this->session->set_flashdata('error', ' O Cliente não encontrado!');	    redirect(base_url('clientes'));	} else {	    $this->data['clienteID'] = $getRestrito;	}        $this->data['eCliente'] = 'Clientes';	$this->data['view'] = 'clientes/editar';        $this->load->view('tema/home',  $this->data);    }        function editarCliente(){                $query = $this->db->get_where('clientes',array('cnpj_cpf ' => $this->input->post('cnpj_cpf')));        $result = $query->result_array();        $cnpj_cpf = limpaCPF_CNPJ($this->input->post('cnpj_cpf'));          $dados = array(            'razao_social_cliente' => $this->input->post('razao_social_cliente'),            'id_responsavel' => $this->input->post('id_responsavel'),            'nome_fantasia_cliente' => $this->input->post('nome_fantasia_cliente'),            'telefone_cliente' => $this->input->post('telefone_cliente'),            'ie_cliente' => $this->input->post('ie_cliente'),            'tipo_ie_cliente' => $this->input->post('tipo_ie_cliente'),            'im_cliente' => $this->input->post('im_cliente'),            'cnae_cliente' => $this->input->post('cnae_cliente'),            'cep_cliente' => $this->input->post('cep_cliente'),            'endereco_cliente' => $this->input->post('endereco_cliente'),            'numero_cliente' => $this->input->post('numero_cliente'),            'bairro_cliente' => $this->input->post('bairro_cliente'),            'uf_cliente' => $this->input->post('uf_cliente'),            'pais_cliente' => $this->input->post('pais_cliente'),            'codigo_pais' => $this->input->post('codigo_pais'),            'codigo_cidade_cliente' => $this->input->post('codigo_cidade_cliente'),            'data_cadastro' => date('Y-m-d H:i:s')        );        if ($this->all_model->editarDados('clientes', $dados, 'id_clientes', $this->input->post('id_clientes')) == TRUE) {            echo json_encode(array('result' => true, 'mensagen' => 'Cliente Editado com Sucesso'));        } else {            echo json_encode(array('result' => false, 'mensagen' => 'Ops, houve um error!'));        }            }        function excluir(){	if(!$this->permission->checkPermission($this->session->userdata('permissao'),'dCliente')){           $this->session->set_flashdata('error','Você não tem permissão para excluir cliente.');           redirect(base_url());        }	$id =  $this->input->post('id');	if($this->all_model->deletaDados('clientes','id_clientes',$id) == TRUE){            $this->session->set_flashdata('success','Cliente excluido com sucesso!');             redirect(base_url('clientes'));          }else{            $this->session->set_flashdata('error',' Ops! algo deu errado');            redirect(base_url('clientes'));         }                  }          function excluirModal($id){	if(!$this->permission->checkPermission($this->session->userdata('permissao'),'dCliente')){           $this->session->set_flashdata('error','Você não tem permissão para excluir cliente.');           redirect(base_url());        }		if($this->all_model->deletaDados('clientes','id_clientes',$id) == TRUE){            $this->session->set_flashdata('success','Cliente excluido com sucesso!');             redirect(base_url('clientes/lista_clientes'));          }else{            $this->session->set_flashdata('error',' Ops! algo deu errado');            redirect(base_url('clientes/lista_clientes'));         }                  }}